<app-header />

<section class="container mt-3 mb-3">
  <mat-card>
    <mat-card-header>
      <mat-card-title-group>
        <mat-card-subtitle>My collections</mat-card-subtitle>
        <mat-card-title *ngIf="!collections.length">No collection yet. Create it!</mat-card-title>
        <div class="">
          <button *ngIf="!createMode" mat-raised-button color="warn" (click)="creatingMode()">
            Create new collection
          </button>
          <button *ngIf="createMode" mat-raised-button color="warn" (click)="viewMode()">
            Cancel without save
          </button>
        </div>
      </mat-card-title-group>
    </mat-card-header>
    <mat-card-content class="mt-3">
      <app-collection-form
        *ngIf="createMode"
        (collectionData)="save($event)"
        class="mb-3 d-block"
      />
      <mat-accordion class="justify-content-between">
        <mat-expansion-panel
          *ngFor="let item of collections; let i = index"
          [expanded]="collectionInx === i"
          [disabled]="createMode"
          (opened)="setStep(i)"
        >
          <mat-expansion-panel-header>
            <mat-panel-title> {{ item.name }} ({{ item.symbol }})</mat-panel-title>
            <mat-panel-description class="justify-content-end gap-1">
              <span>{{ item.description }}</span>
              <mat-icon>info_outline</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <ng-template matExpansionPanelContent>
            <div class="d-flex justify-content-between gap-3">
              <div class="" *ngIf="!editMode && editableInx !== i">
                <p class="fs-6 mb-3">
                  Name:
                  <span class="text-light text-opacity-50">
                    {{ item.name }} ({{ item.symbol }})
                  </span>
                </p>
                <p class="fs-6 mb-3">
                  Contract:
                  <span class="text-light text-opacity-50">{{ item.contractAddress }}</span>
                </p>
                <p class="fs-6 mb-3">
                  Price:
                  <span class="text-light text-opacity-50"
                    >{{ item.mintPrice }} {{ item.mintCurrency }}</span
                  >
                </p>
                <p class="fs-6 mb-3">
                  Minted:
                  <span class="text-light text-opacity-50">{{ item.mintedItems }}</span>
                </p>
                <p class="fs-6 mb-3">
                  Total amount:
                  <span class="text-light text-opacity-50">{{ item.totalAmount }}</span>
                </p>
                <p class="fs-6 mb-3">
                  Remaining:
                  <span class="text-light text-opacity-50">{{ remaining }}</span>
                </p>
                <p class="fs-6 mb-3">
                  Sold amount:
                  <span class="text-light text-opacity-50">
                    {{ item.soldAmount }} {{ item.mintCurrency }}
                  </span>
                </p>
                <p class="fs-6 mb-3">
                  Unclaimed amount:
                  <span class="text-light text-opacity-50">
                    {{ item.unclaimedAmount }} {{ item.mintCurrency }}
                  </span>
                </p>
                <p class="fs-6 mb-3">
                  Max items per address:
                  <span class="text-light text-opacity-50">
                    {{ item.maxItemsPerAddress }}
                  </span>
                </p>
                <p class="fs-6 mb-3">
                  Editable:
                  <span class="text-light text-opacity-50">
                    {{ item.editable }}
                  </span>
                </p>
              </div>
              <app-quick-edit-form
                *ngIf="editableInx === i"
                [collection]="collection"
                (saveData)="closeEdit($event)"
              />
              <div class="">
                <img
                  class="img-preview border border-danger-subtle border-5 border-opacity-50 rounded-1"
                  [src]="item.imageURI"
                  alt=""
                />
              </div>
            </div>
            <mat-divider class="mt-3 mb-3" />
            <div class="d-flex justify-content-end gap-3 align-items-center">
              <span *ngIf="disableClaim">
                Claimable amount less than {{ MIN_CLAIMABLE_AMOUNT }} {{ item.mintCurrency }}
              </span>
              <button mat-raised-button color="accent" [disabled]="disableClaim" (click)="claim()">
                Claim
              </button>
              <button
                mat-raised-button
                color="accent"
                [disabled]="disableClaim"
                (click)="toMintPage()"
              >
                Mint page
              </button>
              <button
                mat-raised-button
                color="primary"
                [disabled]="!item.editable || editMode"
                (click)="edit()"
              >
                Edit
              </button>
              <button mat-raised-button color="warn" (click)="disable()">Disable</button>
            </div>
          </ng-template>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-card-content>
  </mat-card>
</section>
